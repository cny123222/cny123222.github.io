

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Nuoyan Chen">
  <meta name="keywords" content="">
  
    <meta name="description" content="这是《操作系统》课程的课程笔记系列。本文整理部分为“第5章：I&#x2F;O管理”。">
<meta property="og:type" content="article">
<meta property="og:title" content="操作系统(5)：I&#x2F;O管理">
<meta property="og:url" content="https://cny123222.github.io/2025/07/18/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-5-%EF%BC%9AI-O%E7%AE%A1%E7%90%86/index.html">
<meta property="og:site_name" content="Nuoyan Chen&#39;s Blog">
<meta property="og:description" content="这是《操作系统》课程的课程笔记系列。本文整理部分为“第5章：I&#x2F;O管理”。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cny123222.github.io/img/os-new.png">
<meta property="article:published_time" content="2025-07-18T01:48:44.000Z">
<meta property="article:modified_time" content="2025-08-23T14:34:38.390Z">
<meta property="article:author" content="Nuoyan Chen">
<meta property="article:tag" content="操作系统">
<meta property="article:tag" content="课程笔记">
<meta property="article:tag" content="知识点整理">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cny123222.github.io/img/os-new.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>操作系统(5)：I/O管理 - Nuoyan Chen&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.16.2/katex.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"cny123222.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":3},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 80vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Nuoyan Chen&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/nanjing.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.4)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="操作系统(5)：I/O管理"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Nuoyan Chen
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-07-18 09:48" pubdate>
          July 18, 2025 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.3k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          36 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        

      
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="操作系统"
        id="heading-30d23ef4f49e85f37f54786ff984032c" role="tab" data-toggle="collapse" href="#collapse-30d23ef4f49e85f37f54786ff984032c"
        aria-expanded="true"
      >
        操作系统
        <span class="list-group-count">(6)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-30d23ef4f49e85f37f54786ff984032c"
           role="tabpanel" aria-labelledby="heading-30d23ef4f49e85f37f54786ff984032c">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2025/10/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-SJTU-%E7%89%88-1-%EF%BC%9A%E6%A6%82%E8%BF%B0/" title="操作系统 SJTU 版(1)：概述"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">操作系统 SJTU 版(1)：概述</span>
        </a>
      
    
      
      
        <a href="/2025/06/13/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-1-%EF%BC%9A%E6%A6%82%E8%BF%B0/" title="操作系统(1)：概述"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">操作系统(1)：概述</span>
        </a>
      
    
      
      
        <a href="/2025/06/18/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-2-%EF%BC%9A%E5%A4%84%E7%90%86%E6%9C%BA%E7%AE%A1%E7%90%86/" title="操作系统(2)：处理机管理"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">操作系统(2)：处理机管理</span>
        </a>
      
    
      
      
        <a href="/2025/07/11/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-3-%EF%BC%9A%E5%AD%98%E5%82%A8%E5%99%A8%E7%AE%A1%E7%90%86/" title="操作系统(3)：存储器管理"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">操作系统(3)：存储器管理</span>
        </a>
      
    
      
      
        <a href="/2025/07/17/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-4-%EF%BC%9A%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/" title="操作系统(4)：文件管理"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">操作系统(4)：文件管理</span>
        </a>
      
    
      
      
        <a href="/2025/07/18/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-5-%EF%BC%9AI-O%E7%AE%A1%E7%90%86/" title="操作系统(5)：I/O管理"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">操作系统(5)：I/O管理</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">操作系统(5)：I/O管理</h1>
            
              <p id="updated-time" class="note note-default" style="">
                
                  
                    Last updated on August 23, 2025 pm
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>这是《操作系统》课程的课程笔记系列。本文整理部分为“第5章：I/O管理”。</p>
<span id="more"></span>
<h2 id="5-1-I-O-管理概述">5.1 I/O 管理概述</h2>
<h3 id="5-1-1-I-O-设备">5.1.1 I/O 设备</h3>
<ul>
<li><strong>I/O 设备</strong>：将数据输入/输出计算机的外部设备</li>
<li><strong>按使用特性分类</strong>：人机交互类外部设备、存储设备、网络通信设备</li>
<li><strong>按传输速率分类</strong>：低速设备、中速设备、高速设备</li>
<li><strong>按信息交换的单位分类</strong>：
<ul>
<li><strong>块设备</strong>：传输快，可寻址</li>
<li><strong>字符设备</strong>：传输慢，不可寻址，常采用中断驱动方式</li>
</ul>
</li>
</ul>
<h3 id="5-1-2-I-O-控制">5.1.2 I/O 控制</h3>
<ul>
<li><strong>I/O 设备的组成</strong>：机械部件和电子部件组成，其中电子部件即为 I/O 控制器</li>
<li><strong>I/O 控制器的功能</strong>：用于实现对 I/O 设备的控制
<ul>
<li>接受和识别 CPU 发出的命令（要有控制寄存器）</li>
<li>向 CPU 报告设备的状态（要有状态寄存器）</li>
<li>数据交换（要有数据寄存器）</li>
<li>地址识别（由 I/O 逻辑实现）</li>
</ul>
</li>
<li><strong>I/O 控制器的组成</strong>：
<ul>
<li><strong>CPU 与控制器之间的接口</strong>：实现控制器与 CPU 之间的通信</li>
<li><strong>I/O 逻辑</strong>：识别 CPU 发出的命令，并向设备发出命令</li>
<li><strong>控制器与设备之间的接口</strong>：实现控制器与设备之间的通信</li>
</ul>
</li>
<li><strong>两种寄存器编址方式</strong>：
<ul>
<li><strong>内存映射 I/O</strong>：
<ul>
<li>控制器中的寄存器与内存统一编址</li>
<li>可采用对内存进行操作的指令来对控制器进行操作</li>
</ul>
</li>
<li><strong>寄存器独立编址</strong>：
<ul>
<li>控制器中的寄存器独立编址</li>
<li>需要设置专门的指令来操作控制器</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-1-3-I-O-控制方式">5.1.3 I/O 控制方式</h3>
<table>
<thead>
<tr>
<th style="text-align:center">控制方式</th>
<th style="text-align:center">完成一次读/写过程</th>
<th style="text-align:center">CPU 干预频率</th>
<th style="text-align:center">每次 I/O 的数据传输单位</th>
<th style="text-align:center">数据流向</th>
<th style="text-align:center">优点</th>
<th style="text-align:center">缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">程序直接控制方式</td>
<td style="text-align:center">CPU 发出 I/O 命令后需要不断<strong>轮询</strong></td>
<td style="text-align:center">极高</td>
<td style="text-align:center">字</td>
<td style="text-align:center">设备<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span>CPU<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span>内存；<br>内存<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span>CPU<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span>设备</td>
<td style="text-align:center">实现简单</td>
<td style="text-align:center">CPU 和 I/O 设备只能串行工作，CPU 长期处于“忙等”状态，利用率低</td>
</tr>
<tr>
<td style="text-align:center">中断驱动方式</td>
<td style="text-align:center">CPU 发出 I/O 命令后可以做其他事，本次 I/O 完成后设备控制器发出中断信号</td>
<td style="text-align:center">高</td>
<td style="text-align:center">字</td>
<td style="text-align:center">设备<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span>CPU<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span>内存；<br>内存<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span>CPU<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span>设备</td>
<td style="text-align:center">CPU 和 I/O 设备可并行工作，CPU 利用率提升</td>
<td style="text-align:center">每个字的传输都要经过 CPU，频繁的中断处理会消耗较多的 CPU 时间</td>
</tr>
<tr>
<td style="text-align:center">DMA 方式</td>
<td style="text-align:center">CPU 发出 I/O 命令后可以做其他事，本次 I/O 完成后 DMA 控制器发出中断信号</td>
<td style="text-align:center">中</td>
<td style="text-align:center">块</td>
<td style="text-align:center">设备<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span>内存；<br>内存<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span>设备</td>
<td style="text-align:center">数据以块传输，CPU 介入频率进一步降度；数据传输不用经过 CPU，传输效率提高；CPU 和 I/O 设备的并行性提升</td>
<td style="text-align:center">CPU 每发出一条 I/O 指令，只能读/写一个或多个连续的数据块</td>
</tr>
<tr>
<td style="text-align:center">通道控制方式</td>
<td style="text-align:center">CPU 发出 I/O 命令后可以做其他事，通道会执行通道程序以完成 I/O，完成后通道向 CPU 发出中断信号</td>
<td style="text-align:center">低</td>
<td style="text-align:center">一组块</td>
<td style="text-align:center">设备<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span>内存；<br>内存<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span>设备</td>
<td style="text-align:center">CPU、通道、I/O 设备可并行工作，资源利用率高</td>
<td style="text-align:center">实现复杂，需要专门的通道硬件支持</td>
</tr>
</tbody>
</table>
<h3 id="5-1-4-I-O-软件层次结构">5.1.4 I/O 软件层次结构</h3>
<ul>
<li><strong>用户层软件</strong>：实现与用户交互的接口，向上提供方便易用的库函数</li>
<li><strong>设备独立性软件</strong>：
<ul>
<li>向上层提供统一的调用接口（系统调用）</li>
<li>设备的保护</li>
<li>差错处理</li>
<li>设备的分配与回收</li>
<li>数据缓冲区管理</li>
<li>建立逻辑设备名到物理设备名的映射关系；根据设备类型选择调用相应的驱动程序
<ul>
<li>通过 <strong>逻辑设备表（LUT, Logical Unit Table）</strong> 进行</li>
</ul>
</li>
</ul>
</li>
<li><strong>设备驱动程序</strong>：设置设备寄存器、检查设备状态</li>
<li><strong>中断处理程序</strong>：进行中断处理</li>
<li><strong>硬件</strong>：执行 I/O 操作，由机械部件和电子部件组成</li>
</ul>
<h3 id="5-1-5-I-O-应用程序接口和驱动程序接口">5.1.5 I/O 应用程序接口和驱动程序接口</h3>
<ul>
<li><strong>应用程序 I/O 接口</strong>：
<ul>
<li><strong>字符设备接口</strong>：用于字符设备（如键盘、打印机），不可寻址，读 / 写以字符为单位
<ul>
<li><code>get</code> / <code>put</code> <strong>系统调用</strong>：向字符设备读 / 写一个字符</li>
</ul>
</li>
<li><strong>块设备接口</strong>：用于块设备（如磁盘），读 / 写以数据块为单位
<ul>
<li><code>read</code> / <code>write</code> <strong>系统调用</strong>：向块设备的读写指针位置读 / 写多个字符</li>
<li><code>seek</code> <strong>系统调用</strong>：修改读写指针位置</li>
</ul>
</li>
<li><strong>网络设备接口</strong>：又称网络套接字接口，用于网络设备（如网卡）
<ul>
<li><code>socket</code> <strong>系统调用</strong>：创建一个网络套接字，需指明网络协议（TCP / UDP）</li>
<li><code>bind</code>：将套接字绑定到某个本地端口</li>
<li><code>connect</code>：将套接字连接到远程地址</li>
<li><code>read</code> / <code>write</code>：从套接字读 / 写数据</li>
</ul>
</li>
</ul>
</li>
<li><strong>阻塞与非阻塞 I/O</strong>：
<ul>
<li><strong>阻塞 I/O</strong>：应用程序发出 I/O 系统调用，进程需转为阻塞态等待
<ul>
<li>如从键盘读一个字符 <code>get</code>（字符设备接口）</li>
</ul>
</li>
<li><strong>非阻塞 I/O</strong>：应用程序发出 I/O 系统调用，系统调用可迅速返回，进程无需阻塞等待
<ul>
<li>如往磁盘写数据 <code>write</code>（块设备接口）</li>
</ul>
</li>
</ul>
</li>
<li><strong>设备驱动程序接口</strong>：操作系统规定好设备驱动程序的接口标准，各厂商必须按要求开发设备驱动程序</li>
</ul>
<h2 id="5-2-设备独立性软件">5.2 设备独立性软件</h2>
<h3 id="5-2-1-I-O-核心子系统">5.2.1 I/O 核心子系统</h3>
<ul>
<li><strong>I/O 子系统</strong>：包括设备独立性软件、设备驱动程序、中断处理程序三层
<ul>
<li>属于操作系统的内核部分，即 I/O 系统</li>
</ul>
</li>
<li><strong>I/O 子系统的功能</strong>：I/O 调度、设备保护、假脱机技术、设备分配与回收、缓冲区管理
<ul>
<li><strong>I/O 调度</strong>：用某种算法确定一个好的顺序来处理各个 I/O 请求</li>
<li><strong>设备保护</strong>：采用文件保护技术实现设备保护
<ul>
<li>在 UNIX 系统中，设备被看作一种特殊的文件，每个设备也会有对应的 FCB</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-2-2-假脱机技术">5.2.2 假脱机技术</h3>
<ul>
<li><strong>脱机技术</strong>：外围控制机＋更高速的设备（磁带）
<ul>
<li><strong>作用</strong>：缓解设备与 CPU 的速度矛盾，实现预输入、缓输出</li>
</ul>
</li>
<li><strong>假脱机技术（SPOOLing 技术）</strong>：用软件的方式模拟脱机技术
<ul>
<li><strong>输入井和输出井</strong>：位于磁盘，模拟脱机输入 / 输出时的磁带</li>
<li><strong>输入进程和输出进程</strong>：模拟脱机输入 / 输出时的外围控制机</li>
<li><strong>输入缓冲区和输出缓冲区</strong>：内存中的缓冲区，输入、输出时的中转站</li>
</ul>
</li>
</ul>
<h3 id="5-2-3-设备的分配和回收">5.2.3 设备的分配和回收</h3>
<ul>
<li><strong>考虑的因素</strong>：
<ul>
<li><strong>固有属性</strong>：
<ul>
<li><strong>独占设备</strong>：一个时段只能分配给一个进程（如打印机）</li>
<li><strong>共享设备</strong>：可同时分配给多个进程使用（如磁盘）
<ul>
<li>宏观上共享使用，微观上交替使用</li>
</ul>
</li>
<li><strong>虚拟设备</strong>：采用 SPOOLing 技术将独占设备改造成虚拟的共享设备</li>
</ul>
</li>
<li><strong>分配算法</strong>：先来先服务、优先级高者优先、短任务优先等</li>
<li><strong>安全性</strong>：
<ul>
<li><strong>安全分配方式</strong>：为进程分配一个设备后就将进程阻塞，本次 I/O 完成后才将进程唤醒
<ul>
<li>一个时段内每个进程只能使用一个设备</li>
<li><strong>优点</strong>：破坏了“请求和保持”条件，不会死锁</li>
<li><strong>缺点</strong>：对于一个进程来说，CPU 和 I/O 设备只能串行工作</li>
</ul>
</li>
<li><strong>不安全分配方式</strong>：进程发出 I/O 请求后，系统为其分配 I/O 设备，进程可继续执行，之后还可以发出新的 I/O 请求；只有某个 I/O 请求得不到满足时才将进程阻塞
<ul>
<li>一个进程可以同时使用多个设备</li>
<li><strong>优点</strong>：进程的计算任务和 I/O 任务可以并行处理，使进程迅速推进- <strong>缺点</strong>：有可能发生死锁</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>静态分配与动态分配</strong>：
<ul>
<li><strong>静态分配</strong>：进程运行前为其分配全部所需资源，运行结束后归还资源
<ul>
<li>破坏了“请求和保持”条件，不会发生死锁</li>
</ul>
</li>
<li><strong>动态分配</strong>：进程运行过程中动态申请设备资源</li>
</ul>
</li>
<li><strong>设备分配管理中的数据结构</strong>：
<ul>
<li>一个通道可控制多个设备控制器，每个设备控制器可控制多个设备</li>
<li><strong>设备控制表（DCT）</strong>：每个设备对应一张 DCT
<ul>
<li><strong>关键字段</strong>：类型 / 标识符 / 状态 / 指向 COCT 的指针 / 等待队列指针</li>
</ul>
</li>
<li><strong>控制器控制表 （COCT）</strong>：每个控制器对应一张 COCT
<ul>
<li><strong>关键字段</strong>：状态 / 指向 CHCT 的指针 / 等待队列指针</li>
</ul>
</li>
<li><strong>通道控制表（CHCT）</strong>：每个控制器对应一张CHCT
<ul>
<li><strong>关键字段</strong>：状态 / 等待队列指针</li>
</ul>
</li>
<li><strong>系统设备表（SDT）</strong>：记录整个系统中所有设备的情况，每个设备对应一个表目
<ul>
<li><strong>关键字段</strong>：设备类型 / 标识符 / DCT / 驱动程序入口</li>
</ul>
</li>
</ul>
</li>
<li><strong>设备分配的步骤</strong>：
<ol>
<li>根据进程请求的物理设备名查找 SDT</li>
<li>根据 SDT 找到 DCT 并分配设备</li>
<li>根据 DCT 找到 COCT 并分配控制器</li>
<li>根据 COCT 找到 CHCT 井分配通道</li>
</ol>
<ul>
<li>只有设备、控制器、通道三者都分配成功时，这次设备分配才算成功，之后便可启动 I/O 设备进行数据传送</li>
<li><strong>缺点</strong>：用户编程时必须使用<strong>物理设备名</strong>
<ul>
<li>若换了一个物理设备，则程序无法运行</li>
<li>若进程请求的物理设备正在忙碌，则即使系统中还有同类型的设备，进程也必须阻塞等待</li>
</ul>
</li>
</ul>
</li>
<li><strong>设备分配步骤的改进</strong>：
<ul>
<li>用户编程时使用<strong>逻辑设备名</strong>申请设备，操作系统负责实现从逻辑设备名到物理设备名的映射（通过 LUT）</li>
<li><strong>逻辑设备表（LUT）的设置</strong>：
<ul>
<li><strong>整个系统只有一张 LUT</strong>：各用户所用的逻辑设备名不允许重复</li>
<li><strong>每个用户一张 LUT</strong>：各个用户的逻辑设备名可重复</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-2-4-缓冲区管理">5.2.4 缓冲区管理</h3>
<ul>
<li><strong>缓冲区</strong>：是一片存储区域，设备独立性软件一般利用<strong>内存</strong>作为缓冲区</li>
<li><strong>缓冲区的作用</strong>：
<ul>
<li>缓和 CPU 与 I/O 设备之间速度不匹配的矛盾</li>
<li>减少对 CPU 的中断频率，放宽对 CPU 中断相应时间的限制</li>
<li>解决数据粒度不匹配的问题</li>
<li>提高 CPU 与 I/O 设备之间的并行性</li>
</ul>
</li>
<li><strong>缓冲区的特性</strong>：
<ul>
<li>当缓冲区数据非空时，不能往缓冲区充入数据，只能从缓冲区把数据传出</li>
<li>当缓冲区为空时，可以往缓冲区充入数据，但必须把缓冲区充满以后，才能从缓冲区把数据传出</li>
</ul>
</li>
<li><strong>单缓冲</strong>：在主存中分配一个缓冲区
<ul>
<li>设备一(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>)一缓冲区一(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>)一工作区一(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>)一处理</li>
<li>处理一块数据<strong>平均耗时</strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>C</mi><mo separator="true">,</mo><mi>T</mi><mo stretchy="false">)</mo><mo>+</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">\max(C,T)+M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span></li>
<li><strong>分析问题的初始状态</strong>：工作区满，缓冲区空</li>
</ul>
</li>
<li><strong>双缓冲</strong>：在主存中分配两个缓冲区
<ul>
<li>处理一块数据<strong>平均耗时</strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>T</mi><mo separator="true">,</mo><mi>C</mi><mo>+</mo><mi>M</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\max(T,C+M)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mclose">)</span></span></span></span></li>
<li><strong>分析问题的初始状态</strong>：工作区空，一个缓冲区满，另一个缓冲区空</li>
</ul>
</li>
<li><strong>循环缓冲</strong>：多个缓冲区链接成循环队列
<ul>
<li><code>in</code> 指针指向第一个空缓冲区，<code>out</code> 指针指向第一个满缓冲区</li>
</ul>
</li>
<li><strong>缓冲池</strong>:由系统中共用的缓冲区组成
<ul>
<li><strong>三个队列</strong>：空缓冲队列、输入队列（装满输入数据）、输出队列（装满输出数据）</li>
<li><strong>四种工作缓冲区</strong>：
<ul>
<li>用于<strong>收容输入</strong>数据的工作缓冲区、用于<strong>提取输入</strong>数据的工作缓冲区</li>
<li>用于<strong>收容输出</strong>数据的工作缓冲区、用于<strong>提取输出</strong>数据的工作缓冲区</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="5-3-磁盘和固态硬盘">5.3 磁盘和固态硬盘</h2>
<h3 id="5-3-1-磁盘的结构">5.3.1 磁盘的结构</h3>
<ul>
<li><strong>磁盘、磁道、扇区</strong>：
<ul>
<li>磁盘由表面涂有磁性物质的圆形盘片组成</li>
<li>每个盘片被划分为一个个磁道，每个磁道又划分为一个个扇区</li>
</ul>
</li>
<li><strong>磁盘的读/写过程</strong>：磁头移动到目标位置，盘片旋转，对应扇区划过磁道</li>
<li><strong>盘面、柱面</strong>：
<ul>
<li>磁盘有多个盘片垂直堆叠，每个盘片有两个盘面</li>
<li>所有盘面中相对位置相同的磁道组成柱面</li>
</ul>
</li>
<li><strong>磁盘的物理地址</strong>：（柱面号，盘面号，扇区号）</li>
<li><strong>磁盘的分类</strong>：
<ul>
<li><strong>根据磁头是否可移动</strong>：
<ul>
<li><strong>固定头磁盘</strong>：每个磁道有一个磁头</li>
<li><strong>移动头磁盘</strong>：每个盘面只有一个磁头</li>
</ul>
</li>
<li><strong>根据盘片是否可更换</strong>：固定盘磁盘、可换盘磁盘</li>
</ul>
</li>
</ul>
<h3 id="5-3-2-磁盘调度算法">5.3.2 磁盘调度算法</h3>
<ul>
<li><strong>一次磁盘读/写操作需要的时间</strong>：
<ul>
<li><strong>寻找时间（寻道时间）</strong>：启动磁臂、移动磁头所花的时间
<ul>
<li>寻找时间是<strong>磁盘调度算法影响的指标</strong></li>
</ul>
</li>
<li><strong>延迟时间</strong>：将目标扇区转到磁头下面所花的时间</li>
<li><strong>传输时间</strong>：读 / 写数据花费的时间</li>
</ul>
</li>
<li><strong>磁盘调度算法</strong>：
<ul>
<li><strong>先来先服务（FCFS）</strong>：按访问请求到达的先后顺序进行处理</li>
<li><strong>最短寻找时间优先（SSTF）</strong>：每次都优先响应距离磁头最近的磁道访问请求
<ul>
<li>贪心算法，能保证眼前最优，但无法保证总的寻道时间最短</li>
<li><strong>缺点</strong>：可能导致饥饿</li>
</ul>
</li>
<li><strong>扫描算法（SCAN）</strong>：只有磁头移动到最边缘的磁道时才可以改变磁头移动方向
<ul>
<li><strong>缺点</strong>：对各个位置磁道的响应频率不平均</li>
</ul>
</li>
<li><strong>循环扫描算法（C-SCAN）</strong>：只有磁头朝某个方向移动时才会响应请求，移动到边缘后立即让磁头返回起点，返回途中不响应任何请求</li>
<li><strong>LOOK 算法</strong>：SCAN 算法的改进，只要在磁头移动方向上不再有请求，就立即改变磁头方向</li>
<li><strong>C-LOOK 算法</strong>：C-SCAN 算法的改进，只要在磁头移动方向上不再有请求，就立即让磁头返回</li>
</ul>
</li>
</ul>
<h3 id="5-3-3-减少磁盘延迟时间的方法">5.3.3 减少磁盘延迟时间的方法</h3>
<ul>
<li><strong>交替编号</strong>：让编号相邻的扇区在物理上不相邻
<ul>
<li><strong>原理</strong>：读取完一个扇区后需要一段时间处理才可以继续读入下一个扇区</li>
</ul>
</li>
<li><strong>错位命名</strong>：让相邻盘面的扇区编号错位
<ul>
<li><strong>原理</strong>：与“交替编号”的原理相同，可降低延迟时间</li>
</ul>
</li>
<li><strong>磁盘地址结构的设计</strong>：（柱面号，盘面号，扇区号）
<ul>
<li><strong>原因</strong>：在读取地址连续的磁盘块时，前者更不需要移动磁头</li>
</ul>
</li>
</ul>
<h3 id="5-3-4-磁盘的管理">5.3.4 磁盘的管理</h3>
<ul>
<li><strong>磁盘初始化</strong>：
<ul>
<li><strong>物理格式化（低级格式化）</strong>：划分扇区</li>
<li><strong>磁盘分区</strong>（C 盘、D 盘、E 盘）</li>
<li><strong>逻辑格式化</strong>：建立文件系统（根目录文件、用于存储空间管理的数据结构等）</li>
</ul>
</li>
<li><strong>引导块</strong>：计算机启动时需要运行初始化程序（自举程序）来完成初始化
<ul>
<li>ROM 中存放很小的自举装入程序</li>
<li>完整的自举程序存放在初始块（引导块）中</li>
</ul>
</li>
<li><strong>坏块的管理</strong>：
<ul>
<li><strong>简单的磁盘</strong>：逻辑格式化时将坏块标记出来
<ul>
<li>在这种方式中，坏块对操作系统不透明</li>
</ul>
</li>
<li><strong>复杂的磁盘</strong>：磁盘控制器维护一个坏块链，并管理备用扇区
<ul>
<li>在这种方式中，坏块对操作系统透明</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-3-5-固态硬盘-SSD">5.3.5 固态硬盘 SSD</h3>
<ul>
<li><strong>原理</strong>：基于闪存技术，属于电可擦除 ROM，即 EEPROM</li>
<li><strong>组成</strong>：
<ul>
<li><strong>闪存翻译层</strong>：负责翻译逻辑块号，找到对应页</li>
<li><strong>存储介质</strong>：多个闪存芯片，每个芯片包含多个块，每个块包含多个页</li>
</ul>
</li>
<li><strong>读写性能特性</strong>：
<ul>
<li><strong>以页为单位读/写</strong>：相当于磁盘的扇区</li>
<li><strong>以块为单位擦除</strong>：擦干净的块，其中的每页都可以写一次，读无限次</li>
<li><strong>支持随机访问</strong>：系统给定一个逻辑地址，闪存翻译层可通过电路迅速定位到对应的物理地址</li>
<li><strong>读快、写慢</strong>：要写的页如果有数据，则不能写入，需要将块内其他页全部复制到一个新的（擦除过的）块中，再写入新的页</li>
</ul>
</li>
<li><strong>与机械硬盘相比的特点</strong>：
<ul>
<li>SSD 读写速度快，随机访问性能高，用电路控制访问位置；机械硬盘通过移动磁臂旋转磁盘控制访问位置，有寻道时间和旋转延迟</li>
<li>SSD 安静无噪音、耐摔抗震、能耗低、造价更贵</li>
<li>SSD 的一个块被擦除次数过多（重复写同一个块）可能会坏，而机械硬盘的扇区不会因为写的次数太多而坏掉</li>
</ul>
</li>
<li><strong>磨损均衡技术</strong>：
<ul>
<li><strong>思想</strong>：将“擦除”平均分布在各个块上，以提升使用寿命</li>
<li><strong>动态磨损均衡</strong>：写入数据时，优先选择累计擦除次数少的新闪存块</li>
<li><strong>静态磨损均衡</strong>：SSD 监测并自动进行数据分配、迁移，让老旧的闪存块承担以读为主的储存任务，让较新的闪存块承担更多的写任务</li>
</ul>
</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="category-chain-item">操作系统</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="print-no-link">#操作系统</a>
      
        <a href="/tags/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/" class="print-no-link">#课程笔记</a>
      
        <a href="/tags/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/" class="print-no-link">#知识点整理</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>操作系统(5)：I/O管理</div>
      <div>https://cny123222.github.io/2025/07/18/操作系统-5-：I-O管理/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Nuoyan Chen</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>July 18, 2025</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/07/25/A-Living-Guide-to-ML4CO/" title="A Living Guide to ML4CO">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">A Living Guide to ML4CO</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/07/17/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-4-%EF%BC%9A%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/" title="操作系统(4)：文件管理">
                        <span class="hidden-mobile">操作系统(4)：文件管理</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
    <div id="giscus" class="giscus"></div>
    <script type="text/javascript">
      Fluid.utils.loadComments('#giscus', function() {
        var options = {"repo":"cny123222/cny123222.github.io","repo-id":"R_kgDOOFgnVw","category":"Announcements","category-id":"DIC_kwDOOFgnV84CnwXM","theme-light":"light","theme-dark":"dark","mapping":"pathname","reactions-enabled":1,"emit-metadata":0,"input-position":"top","lang":"en"};
        var attributes = {};
        for (let option in options) {
          if (!option.startsWith('theme-')) {
            var key = option.startsWith('data-') ? option : 'data-' + option;
            attributes[key] = options[option];
          }
        }
        var light = 'light';
        var dark = 'dark';
        window.GiscusThemeLight = light;
        window.GiscusThemeDark = dark;
        attributes['data-theme'] = document.documentElement.getAttribute('data-user-color-scheme') === 'dark' ? dark : light;
        for (let attribute in attributes) {
          var value = attributes[attribute];
          if (value === undefined || value === null || value === '') {
            delete attributes[attribute];
          }
        }
        var s = document.createElement('script');
        s.setAttribute('src', 'https://giscus.app/client.js');
        s.setAttribute('crossorigin', 'anonymous');
        for (let attribute in attributes) {
          s.setAttribute(attribute, attributes[attribute]);
        }
        var ss = document.getElementsByTagName('script');
        var e = ss.length > 0 ? ss[ss.length - 1] : document.head || document.documentElement;
        e.parentNode.insertBefore(s, e.nextSibling);
      });
    </script>
    <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  




  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        Views: 
        <span id="busuanzi_value_site_pv"></span>
        
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        Visitors: 
        <span id="busuanzi_value_site_uv"></span>
        
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
